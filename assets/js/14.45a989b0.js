(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{260:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"fastlane自动化构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fastlane自动化构建","aria-hidden":"true"}},[t._v("#")]),t._v(" Fastlane自动化构建")]),t._v(" "),a("p",[t._v("之前尝试使用"),a("code",[t._v("Jenkins")]),t._v("来持续集成，但是发现配置起来比较繁琐，后来发现 "),a("a",{attrs:{href:"https://github.com/fastlane/fastlane",target:"_blank",rel:"noopener noreferrer"}},[t._v("Fastlane"),a("OutboundLink")],1),t._v(" 完全可以满足我的需求。Fastlane 是一款为 iOS 和 Android 开发者提供的自动化构建工具，它可以帮助开发者将 App 打包、签名、测试、发布、信息整理、提交 App Store 等工作完整的连接起来，实现完全自动化的工作流，如果使用得当，可以显著的提高开发者的开发效率。")]),t._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("h4",{attrs:{id:"安装-ruby"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-ruby","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装 "),a("a",{attrs:{href:"https://github.com/ruby/ruby",target:"_blank",rel:"noopener noreferrer"}},[t._v("ruby"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("因为 Fastlane 是基于 ruby 的。执行"),a("code",[t._v("ruby -v")]),t._v("看一下 ruby 是否安装，如果没安装可根据文档安装。")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ruby -v\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"安装xcode命令行工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装xcode命令行工具","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装Xcode命令行工具")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("xcode-select  --install\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"安装fastlane"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装fastlane","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装fastlane")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo gem install fastlane\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h2",{attrs:{id:"打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包","aria-hidden":"true"}},[t._v("#")]),t._v(" 打包")]),t._v(" "),a("h4",{attrs:{id:"切换到工程目录初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#切换到工程目录初始化","aria-hidden":"true"}},[t._v("#")]),t._v(" 切换到工程目录初始化")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("fastlane init\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("执行之后会出现下图所以几个选项，根据提示这里一般是选第4个手动设置。\n"),a("img",{attrs:{src:"http://cdn.lzcdev.xyz/2018-05-18-16-27-03.jpg",alt:"2018-05-18-16-27-03"}}),t._v("\n￼\n之后出现下图所示说明初始化成功\n￼\n"),a("img",{attrs:{src:"http://cdn.lzcdev.xyz/2018-05-18-16-29-40.jpg",alt:"2018-05-18-16-29-40"}}),t._v("\n￼\n之后根据提示一直按Enter就可以了。")]),t._v(" "),a("h4",{attrs:{id:"编辑配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编辑配置文件","aria-hidden":"true"}},[t._v("#")]),t._v(" 编辑配置文件")]),t._v(" "),a("p",[t._v("初始化成功之后会看到工程目录下多了一个 fastlane 的文件夹。里面有 Appfile 和 Fastfile 两个文件。首先编辑 Appfile 。填上你的 Bundle Identifier 和 Apple 账号的邮箱.")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('app_identifier("xxx") # The bundle identifier of your app\napple_id("xxx") # Your Apple email address\n\n\n# For more information about the Appfile, see:\n#     https://docs.fastlane.tools/advanced/#appfile\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("之后编辑 Fastfile")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('default_platform(:ios)\n\nplatform :ios do\n  desc "This is a test"\n  lane :make_ipa do\n    # add actions here: https://docs.fastlane.tools/actions\n    dir="./fastlane/build/Package"\n    puts("*************| 打包项目到目录 |*************")\n  \t# 开始打包\n\tgym(\n\t\t#输出的ipa名称\n\t\tscheme: "",#如果没有可不填，不过一般项目里都有\n\t\toutput_name:"fastlane_test#{get_build_number()}",\n\t\tsilent: false,  # 隐藏没有必要的building信息\n\t\tclean:false,\t\t# 是否清空以前的编译信息 true：是\n\t\tconfiguration:"Release",\t# 指定打包方式，Release 或者 Debug\n\t\texport_method:"development",\t# 指定打包所使用的输出方式，目前支持app-store, package, ad-hoc, enterprise, development\n\t\tbuildlog_path: "#{dir}/fastlanelog",  # fastlane构建ipa的日志输出目录\n\t\toutput_directory:"#{dir}",\t# 指定输出文件夹\n\t\t)\n\tputs("\\n*************| 打包完成 |*************\\n")\n  end\nend\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br")])]),a("p",[t._v("编辑好之后执行")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("fastlane make_ipa\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("顺利的话是可以看到下图这样的信息，之后可去相应的文件夹查看打好的包\n"),a("img",{attrs:{src:"http://cdn.lzcdev.xyz/2018-05-18-16-44-22.jpg",alt:"2018-05-18-16-44-22"}}),t._v("\n￼")]),t._v(" "),a("h2",{attrs:{id:"发布上传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发布上传","aria-hidden":"true"}},[t._v("#")]),t._v(" 发布上传")]),t._v(" "),a("p",[t._v("只打好包还是不够的，我们还需要上传到第三方平台或者 App Store 。")]),t._v(" "),a("h4",{attrs:{id:"上传到蒲公英"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传到蒲公英","aria-hidden":"true"}},[t._v("#")]),t._v(" 上传到"),a("a",{attrs:{href:"https://www.pgyer.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("蒲公英"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("有了ipa包之后这里其实就比较简单了，"),a("a",{attrs:{href:"https://www.pgyer.com/doc/view/fastlane",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1),t._v("说的很清楚。安装蒲公英的 Fastlane 插件后，这里只需在刚才的脚本下面加上一句话就可以了")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('pgyer(api_key: "7f15xxxxxxxxxxxxxxxxxx141", user_key: "4a5bcxxxxxxxxxxxxxxx3a9e")\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("之后在执行之前的打包命令就可以实现自动打包并上传到蒲公英了。")]),t._v(" "),a("h4",{attrs:{id:"上传到-app-store"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传到-app-store","aria-hidden":"true"}},[t._v("#")]),t._v(" 上传到 App Store")]),t._v(" "),a("p",[t._v("这一步也很简单，把刚才蒲公英的脚本替换成 "),a("code",[t._v("upload_to_app_store")]),t._v("就可以了")]),t._v(" "),a("h2",{attrs:{id:"完整-demo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#完整-demo","aria-hidden":"true"}},[t._v("#")]),t._v(" 完整 Demo")]),t._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("default_platform"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":ios")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nplatform "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":ios")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  desc "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Description of what the lane does"')]),t._v("\n  lane "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":custom_lane")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# add actions here: https://docs.fastlane.tools/actions")]),t._v("\n    dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./fastlane/build/Package"')]),t._v("\n    puts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*************| 打包项目到目录 |*************"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开始打包")]),t._v("\n\tgym"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#输出的ipa名称")]),t._v("\n\t\tscheme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\toutput_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fastlane_test_'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token delimiter tag"}},[t._v("#{")]),t._v("get_build_number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token delimiter tag"}},[t._v("}")])]),t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tsilent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 隐藏没有必要的building信息")]),t._v("\n\t\tclean"),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否清空以前的编译信息 true：是")]),t._v("\n\t\tconfiguration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Release"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定打包方式，Release 或者 Debug")]),t._v("\n\t\texport_method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"development"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定打包所使用的输出方式，目前支持app-store, package, ad-hoc, enterprise, development")]),t._v("\n\t\tbuildlog_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token delimiter tag"}},[t._v("#{")]),t._v("dir"),a("span",{pre:!0,attrs:{class:"token delimiter tag"}},[t._v("}")])]),t._v('/fastlanelog"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# fastlane构建ipa的日志输出目录")]),t._v("\n\t\toutput_directory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token delimiter tag"}},[t._v("#{")]),t._v("dir"),a("span",{pre:!0,attrs:{class:"token delimiter tag"}},[t._v("}")])]),t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定输出文件夹")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tputs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n*************| 打包完成 |*************\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tpgyer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("api_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 上传到蒲公英")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# upload_to_app_store # 上传到App store")]),t._v("\n \tnotification"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"打包成功!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"打包成功,已成功上传"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br")])]),a("Vssue")],1)}),[],!1,null,null,null);s.default=e.exports}}]);